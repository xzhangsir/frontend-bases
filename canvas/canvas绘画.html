<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>画图</title>
	<style>
		*{
			margin:0;
			padding:0;
		}
		body{
			background: #fff;
		}
		canvas{
			border:1px solid #000;
			margin:0 auto;
			display: block;
		}
		input[type="color"]{
			position: absolute;
			top:10%;
			left:5%;
		}
		input[type="range"]{
			position: absolute;
			top:20%;
			left:3%;
		}
		input[type="button"]{
			position: absolute;
			top:30%;
			left:5%;
		}
		#btn{
			position: absolute;
			position: absolute;
			top:50%;
			left:5%;
		}
	</style>
</head>
<body>
	<canvas width = "1000" height = "600"></canvas>
	<input type="color">
	<input type="range" min = '1' max = '10' value="3">
	<input type="button" value = "橡皮擦">
    <button id="btn" onclick="download()">点我下载</button>
	<script>
		var canvas = document.getElementsByTagName('canvas')[0];
		var col = document.getElementsByTagName('input')[0];
		var range = document.getElementsByTagName('input')[1];
		var but = document.getElementsByTagName('input')[2];
		var ctx = canvas.getContext('2d');
		var X,Y;
		//改变画笔颜色
		col.onchange = function(){
			ctx.strokeStyle  = this.value;
		}
		//改变画笔粗细
		range.onchange = function(){
			ctx.lineWidth = this.value;
		}
		//橡皮擦
		but.onclick = function(){
			//当前的笔触和背景颜色相同
			ctx.strokeStyle = '#fff';
		}
		canvas.onmousedown = function(e){
			ctx.beginPath();//开启路径
			
			X = e.offsetX || e.layerX;
			Y = e.offsetY || e.layerY;
			
			ctx.moveTo(X,Y);// 路径起点
			canvas.onmousemove = function(e){
					X = e.offsetX;
					Y = e.offsetY;
					ctx.lineTo(X,Y);//结束点
					ctx.stroke();	
			}
		}
		canvas.onmouseup = function(e){
			//结束路劲
			ctx.closePath();
			//取消鼠标移动事件	
			this.onmousemove = null;				
		}
		// 下载
		function imgType(ty) {
	        let type = ty.toLowerCase().replace(/jpg/i, 'jpeg');
	        var r = type.match(/png|jpeg|bmp|gif/)[0];
	        return 'image/' + r;
   		}

	    function download() {

	        let type = 'png';   //设置下载图片的格式

	        let img_png_src = canvas.toDataURL("image/png");  //将canvas保存为图片

	        let imgData = img_png_src.replace(imgType(type),'image/octet-stream');

	        let filename = '图片' + '.' + type; //下载图片的文件名

	        saveFile(imgData,filename);
	    }

	    let saveFile = function(data, fileName){
	        let save_link = document.createElement('a');
	        save_link.href = data;
	        save_link.download = fileName;

	        let event = document.createEvent('MouseEvents');
	        event.initEvent("click", true, false);
	        save_link.dispatchEvent(event);
	    };
	</script>
</body>
</html>
	
	